{
  HashMap index=new HashMap();
  String[] allEntityTokens=(String[])entities.keySet().toArray(new String[0]);
  for (int t=0; t < allEntityTokens.length; t++) {
    String entityTokens=allEntityTokens[t];
    String[] eTokens=entityTokens.split("~");
    for (int i=0; i < eTokens.length; i++) {
      String sub="";
      for (int j=i; j < eTokens.length; j++) {
        if (j > i)         sub=sub + "~";
        sub=sub + eTokens[j];
        if (entityTokens.equals(sub))         continue;
        boolean superStringEligible;
        if (superStringPosition == 1) {
          superStringEligible=entityTokens.startsWith(sub);
        }
 else         if (superStringPosition == 2) {
          superStringEligible=entityTokens.contains(sub) && (!entityTokens.startsWith(sub)) && (!entityTokens.endsWith(sub));
        }
 else         if (superStringPosition == 3) {
          superStringEligible=entityTokens.endsWith(sub);
        }
 else {
          superStringEligible=true;
        }
        if (superStringEligible) {
          if (index.containsKey(sub)) {
            Vector v=(Vector)index.get(sub);
            v.add(entityTokens);
            index.put(sub,v);
          }
 else {
            Vector v=new Vector();
            v.add(entityTokens);
            index.put(sub,v);
          }
        }
      }
    }
  }
  return index;
}
