{
  HashMap<String,List<String>> index=new HashMap<String,List<String>>();
  for (  String entityTokens : entities.keySet()) {
    String[] eTokens=entityTokens.split("~");
    for (int i=0; i < eTokens.length; i++) {
      String sub="";
      for (int j=i; j < eTokens.length; j++) {
        if (j > i)         sub=sub + "~";
        sub=sub + eTokens[j];
        if (entityTokens.equals(sub))         continue;
        boolean superStringEligible;
        if (superStringPosition == 1) {
          superStringEligible=entityTokens.startsWith(sub);
        }
 else         if (superStringPosition == 2) {
          superStringEligible=entityTokens.contains(sub) && (!entityTokens.startsWith(sub)) && (!entityTokens.endsWith(sub));
        }
 else         if (superStringPosition == 3) {
          superStringEligible=entityTokens.endsWith(sub);
        }
 else {
          superStringEligible=true;
        }
        if (superStringEligible) {
          if (index.containsKey(sub)) {
            List<String> v=index.get(sub);
            v.add(entityTokens);
            index.put(sub,v);
          }
 else {
            List<String> v=new ArrayList<String>();
            v.add(entityTokens);
            index.put(sub,v);
          }
        }
      }
    }
  }
  return index;
}
