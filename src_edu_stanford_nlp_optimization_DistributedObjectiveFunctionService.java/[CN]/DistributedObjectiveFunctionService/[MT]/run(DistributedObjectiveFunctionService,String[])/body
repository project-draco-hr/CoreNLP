{
  Properties prop=StringUtils.argsToProperties(args);
  String server=prop.getProperty("server");
  if (server == null) {
    System.err.println("You must specify a server with the -server flag.");
    return;
  }
  int serverPort=Integer.parseInt(prop.getProperty("serverPort","4242"));
  int clientPort=Integer.parseInt(prop.getProperty("clientPort","1234"));
  SocketService socketService=new SocketService(service,clientPort);
  System.err.println("Running service on port: " + clientPort);
  new Thread(socketService).start();
  boolean connected=false;
  while (!connected) {
    try {
      System.err.print("connecting ... ");
      SocketClient<Pair<String,Integer>,Object> client=SocketClient.connect(server,serverPort);
      System.err.print("done.\ngetting constructor arguments ... ");
      Object constructorInfo=client.apply(new Pair<String,Integer>(InetAddress.getLocalHost().getHostName(),clientPort));
      client.disconnect();
      System.err.print("done.\ninit ... ");
      service.init(constructorInfo);
      System.err.println("done");
      connected=true;
    }
 catch (    ServiceException e1) {
      if (e1.getCause() instanceof ConnectException) {
        System.err.println("error connecting to: " + server + ":"+ serverPort+ ".  Trying again in 10 seconds.");
        try {
          Thread.sleep(10000);
        }
 catch (        Exception e2) {
          e2.printStackTrace();
          return;
        }
      }
 else {
        e1.printStackTrace();
        return;
      }
    }
catch (    Exception e3) {
      e3.printStackTrace();
      return;
    }
  }
}
