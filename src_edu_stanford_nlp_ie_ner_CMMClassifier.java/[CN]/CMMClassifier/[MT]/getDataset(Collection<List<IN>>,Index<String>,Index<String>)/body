{
  makeAnswerArraysAndTagIndex(data);
  int size=0;
  for (  List<IN> doc : data) {
    size+=doc.size();
  }
  System.err.print("Making Dataset ... ");
  System.err.flush();
  Dataset<String,String> train;
  if (featureIndex != null && classIndex != null) {
    System.err.println("  Using feature/class Index from existing Dataset...");
    System.err.println("  (This is used when getting Dataset from adaptation set. We want to make the index consistent.)");
    train=new Dataset<>(size,featureIndex,classIndex);
  }
 else {
    train=new Dataset<>(size);
  }
  for (  List<IN> doc : data) {
    if (flags.useReverse) {
      Collections.reverse(doc);
    }
    for (int i=0, dSize=doc.size(); i < dSize; i++) {
      Datum<String,String> d=makeDatum(doc,i,featureFactories);
      train.add(d);
    }
    if (flags.useReverse) {
      Collections.reverse(doc);
    }
  }
  System.err.println("done.");
  if (flags.featThreshFile != null) {
    System.err.println("applying thresholds...");
    List<Pair<Pattern,Integer>> thresh=getThresholds(flags.featThreshFile);
    train.applyFeatureCountThreshold(thresh);
  }
 else   if (flags.featureThreshold > 1) {
    System.err.println("Removing Features with counts < " + flags.featureThreshold);
    train.applyFeatureCountThreshold(flags.featureThreshold);
  }
  train.summaryStatistics();
  return train;
}
