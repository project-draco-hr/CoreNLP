{
  if (input == null)   return null;
  Annotation anno=input.annotation;
  if (needMissingAnnotations) {
    addMissingAnnotation(anno);
  }
  if (Boolean.parseBoolean(props.getProperty("hcoref.useMarkedDiscourse","false"))) {
    anno.set(CoreAnnotations.UseMarkedDiscourseAnnotation.class,true);
  }
  if (input.conllDoc != null && CorefProperties.getLanguage(props) == Locale.CHINESE) {
    CorefProperties.setRemoveNested(props,!input.conllDoc.documentID.contains("nw"));
  }
  List<List<Mention>> mentions=md.findMentions(anno,dict,props);
  Document doc=new Document(input,mentions);
  if (input.goldMentions != null)   findGoldMentionHeads(doc);
  Preprocessor.preprocess(doc,dict,singletonPredictor,headFinder);
  return doc;
}
