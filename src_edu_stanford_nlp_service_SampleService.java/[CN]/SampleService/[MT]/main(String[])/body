{
  ServiceRegistry registry=new ServiceRegistry();
  if (!registry.hasService(SampleService.class.getName())) {
    System.err.println("Running SampleService - run me again in " + "a new terminal to connect ...");
    new Thread(registry.registerSocketService(new SampleService())).run();
  }
 else {
    Function<String,String> session=registry.getService(SampleService.class.getName());
    System.err.println("Connected - type some lines and then press ^d - " + "the service conver them to upper case");
    for (    String line : IOUtils.readLines(System.in)) {
      System.out.println(session.apply(line));
    }
    registry.stopService(SampleService.class.getName());
  }
}
