{
  setWeights(x);
  resetValue();
  resetE();
  for (int bInd=0; bInd < batch.length; bInd++) {
    int docNum=batch[bInd];
    CliqueDataset doc=dataset.getDocument(docNum);
    CRF model=models[docNum];
    updateForDoc(model,doc);
  }
  setDerivativeStochastic(batch);
  if (priorDerivative == null) {
    priorDerivative=new double[x.length];
  }
  System.arraycopy(derivative,0,priorDerivative,0,derivative.length);
  double priorFactor=(batch.length) / ((this.dataDimension()) * prior.getSigma() * prior.getSigma());
  derivative=ArrayMath.pairwiseAdd(derivative,ArrayMath.multiply(x,priorFactor));
  value+=prior.compute(x,priorDerivative);
}
