{
  Duration d=getDuration();
  if (tod != null) {
    Range r=tod.getRange(flags,granularity);
    if (r != null) {
      CompositePartialTime cpt=new CompositePartialTime(this,poy,dow,null);
      Time t1=cpt.intersect(r.beginTime());
      Time t2=cpt.intersect(r.endTime());
      return new Range(t1,t2,d);
    }
 else {
      return super.getRange(flags,granularity);
    }
  }
  if (dow != null) {
    Range r=dow.getRange(flags,granularity);
    if (r != null) {
      CompositePartialTime cpt=new CompositePartialTime(this,poy,dow,null);
      Time t1=cpt.intersect(r.beginTime());
      if (t1 instanceof PartialTime) {
        ((PartialTime)t1).withStandardFields();
      }
      Time t2=cpt.intersect(r.endTime());
      if (t2 instanceof PartialTime) {
        ((PartialTime)t2).withStandardFields();
      }
      return new Range(t1,t2,d);
    }
 else {
      return super.getRange(flags,granularity);
    }
  }
  if (poy != null) {
    Range r=poy.getRange(flags,granularity);
    if (r != null) {
      CompositePartialTime cpt=new CompositePartialTime(this,poy,null,null);
      Time t1=cpt.intersect(r.beginTime());
      Time t2=cpt.intersect(r.endTime());
      return new Range(t1,t2,d);
    }
 else {
      return super.getRange(flags,granularity);
    }
  }
  return super.getRange(flags,granularity);
}
