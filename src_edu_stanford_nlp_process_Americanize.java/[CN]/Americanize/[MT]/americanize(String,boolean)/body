{
  String result;
  if (capitalizeTimex) {
    result=timexMapping.get(str);
    if (result != null) {
      return result;
    }
  }
  result=mapping.get(str);
  if (result != null) {
    return result;
  }
  for (int i=0; i < pats.length; i++) {
    Pattern ex=excepts[i];
    if (ex != null) {
      Matcher me=ex.matcher(str);
      if (me.find()) {
        continue;
      }
    }
    Matcher m=pats[i].matcher(str);
    if (m.find()) {
      return m.replaceAll(reps[i]);
    }
  }
  return str;
}
