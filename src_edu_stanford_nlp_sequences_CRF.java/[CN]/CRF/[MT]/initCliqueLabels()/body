{
  cliqueLabels=new Index[dataset.numDatums()];
  messageLabels=new HashIndex[dataset.numDatums()];
  for (int i=0; i < dataset.numDatums(); i++) {
    Collection<LabeledClique> keySet1=dataset.features[i].keySet();
    if (i > 0 && keySet1.equals(dataset.features[i - 1].keySet())) {
      cliqueLabels[i]=cliqueLabels[i - 1];
    }
 else {
      cliqueLabels[i]=new HashIndex<LabeledClique>(keySet1);
    }
    if (i < messageLabels.length) {
      messageLabels[i]=new HashIndex<LabeledClique>();
    }
    for (    LabeledClique lc : cliqueLabels[i]) {
      if (i > 0) {
        messageLabels[i - 1].add(lc.leftMessage());
      }
      if (i < messageLabels.length) {
        messageLabels[i].add(lc.rightMessage());
      }
    }
    if (i > 1 && messageLabels[i - 2] == messageLabels[i - 1]) {
      messageLabels[i - 1]=messageLabels[i - 2];
    }
    if (i == messageLabels.length - 1 && i > 0 && messageLabels[i - 1].equals(messageLabels[i])) {
      messageLabels[i]=messageLabels[i - 1];
    }
  }
}
