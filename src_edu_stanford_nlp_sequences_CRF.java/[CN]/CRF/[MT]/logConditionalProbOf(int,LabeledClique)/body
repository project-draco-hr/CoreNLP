{
  if (labeledClique.clique != dataset.metaInfo().getMaxClique()) {
    throw new RuntimeException("This method is only valid for the maximum clique!");
  }
  int index=cliqueLabels[position].indexOf(labeledClique);
  if (index < 0) {
    return Double.NEGATIVE_INFINITY;
  }
  if (condProbs[position] == null) {
    condProbs[position]=new double[cliqueLabels[position].size()];
    Arrays.fill(condProbs[position],1.0);
  }
  if (condProbs[position][index] > 0.0) {
    Collection<LabeledClique> otherLabels=dataset.getMaxCliqueConditionalLabels(position,labeledClique);
    int[] otherIndexes=new int[otherLabels.size()];
    double[] toSum=new double[otherLabels.size()];
    int i=0;
    for (    LabeledClique otherLC : otherLabels) {
      int otherIndex=cliqueLabels[position].indexOf(otherLC);
      otherIndexes[i]=otherIndex;
      toSum[i]=factors[position][otherIndex];
      i++;
    }
    double Z=ArrayMath.logSum(toSum);
    for (int j=0; j < otherIndexes.length; j++) {
      condProbs[position][otherIndexes[j]]=factors[position][otherIndexes[j]] - Z;
    }
  }
  return condProbs[position][index];
}
