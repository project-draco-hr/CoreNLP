{
  Set<String> fixed=new HashSet<String>();
  for (Iterator<GeneEvidencePair> iter=genes.iterator(); iter.hasNext(); ) {
    fixed.add(iter.next().geneID);
  }
  for (Iterator<GeneIDPair> iter=ambiguities.iterator(); iter.hasNext(); ) {
    GeneIDPair gene=iter.next();
    double bestScore=0.0;
    double bestSelfScore=0.0;
    String bestId=null;
    for (Iterator iter2=gene.ids.iterator(); iter2.hasNext(); ) {
      String ambiguous=(String)iter2.next();
      double score=0.0;
      for (Iterator<String> iter3=fixed.iterator(); iter3.hasNext(); ) {
        String unambiguous=iter3.next();
        if (fixed.contains(ambiguous)) {
          bestId=null;
          break;
        }
        score+=cm.get(ambiguous,unambiguous);
      }
      if (score > bestScore) {
        bestScore=score;
        bestId=ambiguous;
        bestSelfScore=cm.get(bestId,bestId);
      }
 else       if (score > 0.0 && score == bestScore) {
        double selfScore=cm.get(ambiguous,ambiguous);
        if (selfScore > bestSelfScore) {
          bestSelfScore=selfScore;
          bestId=ambiguous;
        }
 else         if (selfScore == bestSelfScore) {
          bestId=null;
        }
      }
    }
    if (bestId != null) {
      genes.add(new GeneEvidencePair(bestId,gene.gene));
    }
  }
}
