{
  Trees.convertToCoreLabels(tree);
  tree.indexSpans(0);
  sentence.set(TreeCoreAnnotations.TreeAnnotation.class,tree);
  if (verbose) {
    System.err.println("Tree is:");
    tree.pennPrint(System.err);
  }
  if (buildGraphs) {
    String docID=sentence.get(CoreAnnotations.DocIDAnnotation.class);
    if (docID == null) {
      docID="";
    }
    Integer sentenceIndex=sentence.get(CoreAnnotations.SentenceIndexAnnotation.class);
    int index=(sentenceIndex == null) ? 0 : sentenceIndex;
    SemanticGraph deps=SemanticGraphFactory.generateCollapsedDependencies(gsf.newGrammaticalStructure(tree),docID,index);
    SemanticGraph uncollapsedDeps=SemanticGraphFactory.generateUncollapsedDependencies(gsf.newGrammaticalStructure(tree),docID,index);
    SemanticGraph ccDeps=SemanticGraphFactory.generateCCProcessedDependencies(gsf.newGrammaticalStructure(tree),docID,index);
    if (verbose) {
      System.err.println("SDs:");
      System.err.println(deps.toString(SemanticGraph.OutputFormat.LIST));
    }
    sentence.set(SemanticGraphCoreAnnotations.CollapsedDependenciesAnnotation.class,deps);
    sentence.set(SemanticGraphCoreAnnotations.BasicDependenciesAnnotation.class,uncollapsedDeps);
    sentence.set(SemanticGraphCoreAnnotations.CollapsedCCProcessedDependenciesAnnotation.class,ccDeps);
  }
  setMissingTags(sentence,tree);
}
