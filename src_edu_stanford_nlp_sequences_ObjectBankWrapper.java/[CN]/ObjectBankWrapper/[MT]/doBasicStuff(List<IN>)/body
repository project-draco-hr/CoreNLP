{
  int position=0;
  for (  IN fl : doc) {
    fl.set(PositionAnnotation.class,Integer.toString((position++)));
    if ((flags.wordShape > WordShapeClassifier.NOWORDSHAPE) && (!flags.useShapeStrings)) {
      String word=fl.get(TextAnnotation.class);
      if (flags.wordFunction != null) {
        word=flags.wordFunction.apply(word);
      }
      if (word.length() > 0) {
        char ch=word.charAt(0);
        if (Character.isLowerCase(ch)) {
          knownLCWords.add(word);
        }
      }
      String s=intern(WordShapeClassifier.wordShape(word,flags.wordShape,knownLCWords));
      fl.set(ShapeAnnotation.class,s);
    }
    if ("edu.stanford.nlp.wordseg.Sighan2005DocumentReaderAndWriter".equalsIgnoreCase(flags.readerAndWriter)) {
      fl.set(CharAnnotation.class,intern(fix(fl.get(CharAnnotation.class))));
    }
 else {
      fl.set(TextAnnotation.class,intern(fix(fl.get(TextAnnotation.class))));
      fl.set(GoldAnswerAnnotation.class,fl.get(AnswerAnnotation.class));
    }
  }
}
