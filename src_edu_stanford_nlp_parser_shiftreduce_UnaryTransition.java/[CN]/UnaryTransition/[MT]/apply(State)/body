{
  Tree top=state.stack.peek();
  if (!(top.label() instanceof CoreLabel)) {
    throw new IllegalArgumentException("Stack should have CoreLabel nodes");
  }
  CoreLabel topLabel=(CoreLabel)top.label();
  CoreLabel production=new CoreLabel();
  production.setValue(label);
  production.set(TreeCoreAnnotations.HeadWordAnnotation.class,topLabel.get(TreeCoreAnnotations.HeadWordAnnotation.class));
  production.set(TreeCoreAnnotations.HeadTagAnnotation.class,topLabel.get(TreeCoreAnnotations.HeadTagAnnotation.class));
  Tree newTop=new LabeledScoredTreeNode(production);
  newTop.addChild(top);
  TreeShapedStack<Tree> stack=state.stack.pop();
  stack=stack.push(newTop);
  return new State(stack,state.sentence,state.tokenPosition,state.score,false);
}
