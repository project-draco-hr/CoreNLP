{
  final MatchedExpression.SingleAnnotationExtractor valueExtractor=createAnnotationExtractor(env,r);
  Pattern pattern=env.getStringPattern(expr);
  valueExtractor.valueExtractor=new CoreMapFunctionApplier<String,Value>(env,r.annotationField,new StringPatternExtractRule<Value>(pattern,new StringMatchResultExtractor(env,action,result)));
  r.extractRule=new CoreMapExtractRule<String,MatchedExpression>(env,r.annotationField,new StringPatternExtractRule<MatchedExpression>(pattern,new StringMatchedExpressionExtractor(valueExtractor,r.matchedExpressionGroup)));
  r.filterRule=new AnnotationMatchedFilter(valueExtractor);
}
