{
  if (isRoot)   return (negDesc ? !sg.getRoots().contains(node) : sg.getRoots().contains(node));
  if (isEmpty)   return (negDesc ? !node.equals(IndexedWord.NO_WORD) : node.equals(IndexedWord.NO_WORD));
  for (  Map.Entry<String,Pair<Pattern,Pattern>> attr : attributes.entrySet()) {
    String key=attr.getKey();
    String nodeValue;
    Class c=Env.lookupAnnotationKey(env,key);
    Object value=node.get(c);
    if (value == null)     nodeValue=null;
 else     nodeValue=value.toString();
    if (nodeValue == null)     return negDesc;
    Pattern valuePattern=ignoreCase ? attr.getValue().second : attr.getValue().first;
    boolean matches=false;
    if (valuePattern.matcher(nodeValue).matches()) {
      matches=true;
    }
    if (!matches) {
      return negDesc;
    }
  }
  return !negDesc;
}
