{
  if (!isBaseLocked()) {
    base.tuneParameters(expectedEmissions,hmm);
    Set vocab=new HashSet(base.getCounter().keySet());
    for (Iterator iter=vocab.iterator(); iter.hasNext(); ) {
      String s=(String)iter.next();
      if (base.get(s) < getUnseen(s) / 2.0) {
        base.set(s,0.0);
      }
    }
  }
  double total=0.0;
  for (  String key : expectedEmissions.keySet()) {
    if ((Filters.collectionAcceptFilter(hmm.getVocab().keySet())).accept(key)) {
      total+=expectedEmissions.getCount(key);
    }
  }
  double totalSeen=(total) + seenSmoothing;
  double total1=0.0;
  for (  String key : expectedEmissions.keySet()) {
    if ((Filters.collectionRejectFilter(hmm.getVocab().keySet())).accept(key)) {
      total1+=expectedEmissions.getCount(key);
    }
  }
  double totalUnseen=(total1) + seenSmoothing;
  double newVal=totalSeen / (totalSeen + totalUnseen);
  double change=Math.abs(newVal - seenP);
  seenP=newVal;
  return (change);
}
