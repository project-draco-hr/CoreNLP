{
  if (state == 0) {
    System.err.println("Can't insert after end state");
    return -1;
  }
  ArrayList<Double> newTransitions=new ArrayList<Double>();
  for (int i=0; i < transitions.size(); i++) {
    newTransitions.add(ZERO);
  }
  transitions.add(newTransitions);
  for (  List<Double> transition : transitions) {
    transition.add(ZERO);
  }
  ArrayList<Double> outTransitions=(ArrayList<Double>)transitions.get(state);
  for (int i=0; i < outTransitions.size(); i++) {
    Double tProb=outTransitions.get(i);
    if (tProb.doubleValue() != 0.0 && i != state) {
      newTransitions.set(i,tProb);
      outTransitions.set(i,ZERO);
    }
  }
  outTransitions.set(outTransitions.size() - 1,ONE);
  stateTypes.add(Integer.valueOf(type));
  return transitions.size() - 1;
}
