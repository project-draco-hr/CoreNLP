{
  double[] scores=new double[transitionIndex.size()];
  for (  String feature : features) {
    List<ScoredObject<Integer>> weights=featureWeights.get(feature);
    if (weights == null) {
      continue;
    }
    for (    ScoredObject<Integer> weight : weights) {
      scores[weight.object()]+=weight.score();
    }
  }
  PriorityQueue<ScoredObject<Integer>> queue=new PriorityQueue<ScoredObject<Integer>>(numTransitions + 1,ScoredComparator.ASCENDING_COMPARATOR);
  for (int i=0; i < scores.length; ++i) {
    if (!requireLegal || transitionIndex.get(i).isLegal(state)) {
      queue.add(new ScoredObject<Integer>(i,scores[i]));
      if (queue.size() > numTransitions) {
        queue.poll();
      }
    }
  }
  return queue;
}
