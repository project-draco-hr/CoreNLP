{
  Set<Class<?>> keysToSerialize=new HashSet<Class<?>>(doc.keySet());
  CoreNLPProtos.Document.Builder builder=toProtoBuilder(doc,keysToSerialize);
  if (enforceLosslessSerialization && !keysToSerialize.isEmpty()) {
    throw new LossySerializationException("Keys are not being serialized: " + StringUtils.join(keysToSerialize));
  }
  return builder.build();
}
