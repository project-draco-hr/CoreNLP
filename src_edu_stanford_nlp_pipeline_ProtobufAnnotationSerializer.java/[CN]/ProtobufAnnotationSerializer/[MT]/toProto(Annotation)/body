{
  CoreNLPProtos.Document.Builder builder=CoreNLPProtos.Document.newBuilder();
  builder.setText(doc.get(TextAnnotation.class));
  if (doc.containsKey(TokensAnnotation.class)) {
    for (    CoreLabel tok : doc.get(TokensAnnotation.class)) {
      builder.addToken(toProto(tok));
    }
  }
  if (doc.containsKey(SentencesAnnotation.class)) {
    for (    CoreMap sentence : doc.get(SentencesAnnotation.class)) {
      builder.addSentence(toProto(sentence));
    }
  }
  if (doc.containsKey(DocIDAnnotation.class)) {
    builder.setDocID(doc.get(DocIDAnnotation.class));
  }
  if (doc.containsKey(CorefChainAnnotation.class)) {
    for (    Map.Entry<Integer,CorefChain> chain : doc.get(CorefChainAnnotation.class).entrySet()) {
      builder.addCorefChain(toProto(chain.getValue()));
    }
  }
  return builder.build();
}
