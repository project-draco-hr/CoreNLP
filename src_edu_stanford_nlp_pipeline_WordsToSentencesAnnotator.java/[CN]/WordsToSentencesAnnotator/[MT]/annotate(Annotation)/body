{
  if (VERBOSE) {
    System.err.print("Sentence splitting ...");
  }
  if (!annotation.has(CoreAnnotations.TokensAnnotation.class)) {
    throw new IllegalArgumentException("WordsToSentencesAnnotator: unable to find words/tokens in: " + annotation);
  }
  String text=annotation.get(CoreAnnotations.TextAnnotation.class);
  List<CoreLabel> tokens=annotation.get(CoreAnnotations.TokensAnnotation.class);
  int tokenOffset=0;
  int lineNumber=0;
  List<CoreMap> sentences=new ArrayList<CoreMap>();
  for (  List<CoreLabel> sentenceTokens : this.wts.process(tokens)) {
    if (countLineNumbers) {
      ++lineNumber;
    }
    if (sentenceTokens.isEmpty()) {
      if (!countLineNumbers) {
        throw new IllegalStateException("unexpected empty sentence: " + sentenceTokens);
      }
 else {
        continue;
      }
    }
    int begin=sentenceTokens.get(0).get(CoreAnnotations.CharacterOffsetBeginAnnotation.class);
    int last=sentenceTokens.size() - 1;
    int end=sentenceTokens.get(last).get(CoreAnnotations.CharacterOffsetEndAnnotation.class);
    String sentenceText=text.substring(begin,end);
    Annotation sentence=new Annotation(sentenceText);
    sentence.set(CoreAnnotations.CharacterOffsetBeginAnnotation.class,begin);
    sentence.set(CoreAnnotations.CharacterOffsetEndAnnotation.class,end);
    sentence.set(CoreAnnotations.TokensAnnotation.class,sentenceTokens);
    sentence.set(CoreAnnotations.TokenBeginAnnotation.class,tokenOffset);
    tokenOffset+=sentenceTokens.size();
    sentence.set(CoreAnnotations.TokenEndAnnotation.class,tokenOffset);
    sentence.set(CoreAnnotations.SentenceIndexAnnotation.class,sentences.size());
    if (countLineNumbers) {
      sentence.set(CoreAnnotations.LineNumberAnnotation.class,lineNumber);
    }
    sentences.add(sentence);
  }
  annotation.set(CoreAnnotations.SentencesAnnotation.class,sentences);
}
