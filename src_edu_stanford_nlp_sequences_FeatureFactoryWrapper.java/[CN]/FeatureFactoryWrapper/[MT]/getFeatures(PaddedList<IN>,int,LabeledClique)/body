{
  if (position != this.position) {
    cache=new HashMap<Clique,ClassicCounter<String>>();
    this.position=position;
  }
  ClassicCounter<Pair<String,LabeledClique>> newFeatures=new ClassicCounter<Pair<String,LabeledClique>>();
  for (  Clique c : wrapped.getCliques()) {
    ClassicCounter<String> cliqueFeatures=cache.get(c);
    LabeledClique cliqueLabel=LabeledClique.valueOf(c,lc,0);
    if (cliqueFeatures == null) {
      cliqueFeatures=new ClassicCounter<String>();
      if (wrapped instanceof RVFFeatureFactory) {
        ClassicCounter<String> tmp=((RVFFeatureFactory<IN>)wrapped).getCliqueFeaturesRVF(info,position,c);
        for (        String f : tmp.keySet()) {
          cliqueFeatures.setCount(Interner.globalIntern(f),tmp.getCount(f));
        }
      }
 else {
        Collection<String> tmp=wrapped.getCliqueFeatures(info,position,c);
        for (        String f : tmp) {
          cliqueFeatures.setCount(Interner.globalIntern(f),1.0);
        }
      }
      cache.put(c,cliqueFeatures);
    }
    for (    String f : cliqueFeatures.keySet()) {
      Pair<String,LabeledClique> feature=new ImmutablePairOfImmutables<String,LabeledClique>(f,cliqueLabel);
      newFeatures.incrementCount(feature,cliqueFeatures.getCount(f));
    }
  }
  return newFeatures;
}
