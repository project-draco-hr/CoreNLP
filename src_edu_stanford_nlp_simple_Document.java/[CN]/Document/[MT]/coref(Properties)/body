{
synchronized (this.impl) {
    if (impl.getCorefChainCount() == 0) {
      this.runLemma(props).runNER(props).runParse(props);
      Annotator mention=props == EMPTY_PROPS ? defaultMention.get() : getOrCreate(AnnotatorFactories.mention(props,backend));
      Annotator coref=props == EMPTY_PROPS ? defaultCoref.get() : getOrCreate(AnnotatorFactories.coref(props,backend));
      Annotation ann=asAnnotation();
      mention.annotate(ann);
      coref.annotate(ann);
synchronized (serializer) {
        for (        CorefChain chain : ann.get(CorefCoreAnnotations.CorefChainAnnotation.class).values()) {
          impl.addCorefChain(serializer.toProto(chain));
        }
      }
    }
    Map<Integer,CorefChain> corefs=Generics.newHashMap();
    for (    CoreNLPProtos.CorefChain chain : impl.getCorefChainList()) {
      corefs.put(chain.getChainID(),fromProto(chain));
    }
    return corefs;
  }
}
