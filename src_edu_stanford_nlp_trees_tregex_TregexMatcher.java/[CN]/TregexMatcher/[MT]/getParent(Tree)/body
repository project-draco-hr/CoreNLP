{
  if (node instanceof HasParent) {
    return node.parent();
  }
  if (nodesToParents == null) {
    nodesToParents=new IdentityHashMap<Tree,Tree>();
  }
  if (nodesToParents.size() == 0) {
    fillNodesToParents(root,null);
  }
  return nodesToParents.get(node);
}
