{
  DatasetMetaInfo metaInfo=new DatasetMetaInfo(metaInfo().featureFactory(),flags.backgroundSymbol);
  DatasetMetaInfo testMetaInfo=new DatasetMetaInfo(metaInfo().featureFactory(),flags.backgroundSymbol);
  if (flags.useObservedSequencesOnly) {
    Collection<LabeledClique> observedSequences=observedSequences(train.iterator(),metaInfo);
    metaInfo.setAllowedSequences(observedSequences);
    Collection<LabeledClique> testObservedSequences=observedSequences(test.iterator(),testMetaInfo);
    testMetaInfo.setAllowedSequences(testObservedSequences);
  }
  MultiDocumentCliqueDataset dataset=new MultiDocumentCliqueDataset(metaInfo,flags,train);
  MultiDocumentCliqueDataset testset=new MultiDocumentCliqueDataset(testMetaInfo,flags,test);
  Interner.getGlobal().clear();
  PrintWriter pw=new PrintWriter(System.err,true);
  dataset.printStats(pw);
  train(dataset,testset,adapt);
}
