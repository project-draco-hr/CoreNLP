{
  Integer atomic=item2Index.get(o);
  if (atomic == null) {
    if (add) {
      final int newIndex=index.getAndIncrement();
      atomic=item2Index.putIfAbsent(o,newIndex);
      if (atomic == null) {
        index2Item.put(newIndex,o);
        return newIndex;
      }
 else {
        return item2Index.get(o);
      }
    }
 else {
      return UNKNOWN_ID;
    }
  }
 else {
    return atomic;
  }
}
