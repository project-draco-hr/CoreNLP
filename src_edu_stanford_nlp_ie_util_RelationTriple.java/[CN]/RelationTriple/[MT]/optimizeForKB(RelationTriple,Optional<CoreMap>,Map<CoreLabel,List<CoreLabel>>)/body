{
  String docid=sentence.isPresent() ? sentence.get().get(CoreAnnotations.DocIDAnnotation.class) : null;
  if (docid == null) {
    docid="no_doc_id";
  }
  Integer sentenceIndex=sentence.isPresent() ? sentence.get().get(CoreAnnotations.SentenceIndexAnnotation.class) : null;
  if (sentenceIndex == null) {
    sentenceIndex=-1;
  }
  List<CoreLabel> subject=null;
  for (int i=input.subject.size() - 1; i >= 0; --i) {
    if ((subject=canonicalMentions.get(input.subject.get(i))) != null) {
      break;
    }
  }
  if (subject == null) {
    subject=input.subject;
  }
  List<CoreLabel> object=null;
  for (int i=input.object.size() - 1; i >= 0; --i) {
    if ((object=canonicalMentions.get(input.object.get(i))) != null) {
      break;
    }
  }
  if (object == null) {
    object=input.object;
  }
  for (  CoreLabel subjToken : subject) {
    if ("PRP".equals(subjToken.tag())) {
      return Optional.empty();
    }
  }
  for (  CoreLabel objToken : object) {
    if ("PRP".equals(objToken.tag())) {
      return Optional.empty();
    }
  }
  boolean hasNER=false;
  for (  CoreLabel subjToken : subject) {
    if (!"O".equals(subjToken.ner())) {
      hasNER=true;
    }
  }
  if (!hasNER) {
    return Optional.empty();
  }
  return Optional.of(new AsKBEntry(subject,input.relation,object,input.confidence,docid,sentenceIndex,subject == input.subject ? Optional.empty() : Optional.of(input.subject),object == input.object ? Optional.empty() : Optional.of(input.object)));
}
