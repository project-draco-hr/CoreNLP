{
  PrintWriter writer=new PrintWriter(new BufferedWriter(new FileWriter(file)));
  try {
    Index<F> featureIndex=data.featureIndex();
    for (int i=0; i < data.size(); ++i) {
      RVFDatum<Double,F> datum=data.getRVFDatum(i);
      Double label=datum.label();
      writer.print(label == null ? 0.0 : label);
      Counter<F> features=datum.asFeaturesCounter();
      Counter<Integer> printCounter=new ClassicCounter<Integer>();
      for (      F f : features.keySet()) {
        printCounter.setCount(featureIndex.indexOf(f),features.getCount(f));
      }
      Integer[] fIDs=printCounter.keySet().toArray(new Integer[printCounter.keySet().size()]);
      Arrays.sort(fIDs);
      for (      int fID : fIDs) {
        double count=printCounter.getCount(fID);
        int index=fID + 1;
        writer.format(" %s:%f",index,count);
      }
      writer.println();
    }
  }
  finally {
    writer.close();
  }
}
