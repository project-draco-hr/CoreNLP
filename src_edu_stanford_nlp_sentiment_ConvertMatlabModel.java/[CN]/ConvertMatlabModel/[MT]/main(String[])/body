{
  String basePath="/user/socherr/scr/projects/semComp/RNTN/src/params/";
  int numSlices=25;
  for (int argIndex=0; argIndex < args.length; ) {
    if (args[argIndex].equalsIgnoreCase("-slices")) {
      numSlices=Integer.valueOf(args[argIndex + 1]);
      argIndex+=2;
    }
 else     if (args[argIndex].equalsIgnoreCase("-path")) {
      basePath=args[argIndex + 1];
      argIndex+=2;
    }
 else {
      System.err.println("Unknown argument " + args[argIndex]);
      System.exit(2);
    }
  }
  SimpleMatrix[] slices=new SimpleMatrix[numSlices];
  for (int i=0; i < numSlices; ++i) {
    slices[i]=loadMatrix(basePath + "bin/Wt_" + (i + 1)+ ".bin",basePath + "Wt_" + (i + 1)+ ".txt");
  }
  SimpleTensor tensor=new SimpleTensor(slices);
  System.err.println("W tensor size: " + tensor.numRows() + "x"+ tensor.numCols()+ "x"+ tensor.numSlices());
  SimpleMatrix W=loadMatrix(basePath + "bin/W.bin",basePath + "W.txt");
  System.err.println("W matrix size: " + W.numRows() + "x"+ W.numCols());
  SimpleMatrix Wcat=loadMatrix(basePath + "bin/Wcat.bin",basePath + "Wcat.txt");
  System.err.println("W cat size: " + Wcat.numRows() + "x"+ Wcat.numCols());
  SimpleMatrix combinedWV=loadMatrix(basePath + "bin/Wv.bin",basePath + "Wv.txt");
  File vocabFile=new File(basePath + "vocab_1.txt");
  if (!vocabFile.exists()) {
    vocabFile=new File(basePath + "words.txt");
  }
  List<String> lines=Generics.newArrayList();
  for (  String line : IOUtils.readLines(vocabFile)) {
    lines.add(line.trim());
  }
  Map<String,SimpleMatrix> wordVectors=Generics.newTreeMap();
  for (int i=0; i < lines.size() - 1; ++i) {
    String[] pieces=lines.get(i).split(" +");
    if (pieces.length > 1) {
      continue;
    }
    wordVectors.put(pieces[0],combinedWV.extractMatrix(0,numSlices,i,i + 1));
  }
  copyWordVector(wordVectors,".",",");
  copyWordVector(wordVectors,".",";");
  copyWordVector(wordVectors,"''","``");
  RNNOptions op=new RNNOptions();
  op.numHid=numSlices;
  op.lowercaseWordVectors=false;
  wordVectors.put(SentimentModel.UNKNOWN_WORD,SimpleMatrix.random(numSlices,1,-0.00001,0.00001,new Random()));
  SentimentModel model=SentimentModel.modelFromMatrices(W,Wcat,tensor,wordVectors,op);
  model.saveSerialized("matlab.ser.gz");
}
