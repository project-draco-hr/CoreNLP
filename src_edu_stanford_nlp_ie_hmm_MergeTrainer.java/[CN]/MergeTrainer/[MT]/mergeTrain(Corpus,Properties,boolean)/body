{
  if (props == null) {
    props=Extractor.getDefaultProperties();
  }
  boolean trainNow=!("conditional").equals(props.getProperty("trainType"));
  String[] corpusTargetFields=trainDocs.getTargetFields();
  String[] targetFields=new String[corpusTargetFields.length - 1];
  for (int i=1; i < corpusTargetFields.length; i++) {
    targetFields[i - 1]=corpusTargetFields[i];
  }
  HMM chmm=null;
  String contextFile=props.getProperty("context.hmmFile");
  if (contextFile != null) {
    if (verbose) {
      System.err.println("Loading " + contextFile + "...");
    }
    try {
      ObjectInputStream in=new ObjectInputStream(new FileInputStream(contextFile));
      chmm=(HMM)in.readObject();
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
 else {
    chmm=new ContextTrainer().train(trainDocs,props,targetFields,verbose);
  }
  HMM[] thmms=new HMM[targetFields.length];
  for (int i=0; i < targetFields.length; i++) {
    String targetFileField=targetFields[i] + ".hmmFile";
    String targetFile=props.getProperty(targetFileField);
    if (targetFile != null) {
      if (verbose) {
        System.err.println("Loading " + targetFile + "...");
      }
      try {
        ObjectInputStream in=new ObjectInputStream(new FileInputStream(targetFile));
        thmms[i]=(HMM)in.readObject();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
 else {
      thmms[i]=new TargetTrainer().train(trainDocs,targetFields[i],props,verbose);
    }
  }
  if (verbose) {
    System.err.println("Merging the HMMs together...");
  }
  HMM finalHMM=new HMM(chmm,thmms,trainNow,verbose);
  if (!trainNow) {
    finalHMM.train(trainDocs,props,verbose);
  }
  return (finalHMM);
}
