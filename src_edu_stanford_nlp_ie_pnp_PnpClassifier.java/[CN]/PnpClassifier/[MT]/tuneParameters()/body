{
  if (parametersTuned) {
    throw (new IllegalStateException("can't call tuneParameters twice"));
  }
  for (int c=1; c <= numCategories; c++) {
    pruneCounts(charSequenceCounts[c],0);
  }
  consolidateHeldOutExamples();
  if (useLengthModel) {
    learnLengthInterpolationConstants();
  }
  if (useCharModel) {
    learnCharInterpolationConstants();
  }
  if (useLengthModel) {
    computeCharSequenceTotals();
  }
  if (useCharModel && useWordModel) {
    learnCharWordInterpolationConstants();
  }
  if (useLengthNormalization) {
    learnLengthNormalizations();
  }
  if (usePriorBoost) {
    learnPriorBoost();
  }
  parametersTuned=true;
  for (int c=1; c <= numCategories; c++) {
    for (int i=0; i < heldOutExamples[c].size(); i++) {
      addCounts(heldOutExamples[c].get(i),c,false,(heldOutWeights[c].get(i)).doubleValue());
    }
  }
}
